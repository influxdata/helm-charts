# Production Configuration
# - Full resource allocation
# - AWS S3 with multiple availability zones
# - High availability with multiple replicas
# - Full monitoring and network policies
# - TLS enabled

objectStorage:
  type: s3
  bucket: "influxdb3"
  s3:
    enabled: true
    region: "us-east-1"
    accessKeyId: "PROD_ACCESS_KEY"
    secretAccessKey: "PROD_SECRET_KEY"

license:
  type: "commercial"
  email: "production@example.com"

# Production ingester configuration
ingester:
  replicas: 3
  resources:
    requests:
      cpu: "4000m"
      memory: "8Gi"
    limits:
      cpu: "8000m"
      memory: "16Gi"
  threads:
    io: 12
    datafusion: 20
  persistence:
    storageClass: "fast-ssd"
    size: "100Gi"
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: ingester
            topologyKey: kubernetes.io/hostname

# Production querier configuration
querier:
  replicas: 3
  resources:
    requests:
      cpu: "4000m"
      memory: "8Gi"
    limits:
      cpu: "8000m"
      memory: "16Gi"
  threads:
    datafusion: 28
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: querier
            topologyKey: kubernetes.io/hostname

# Production compactor configuration - 2x resources for intensive operations
compactor:
  resources:
    requests:
      cpu: "4000m"
      memory: "8Gi"
    limits:
      cpu: "8000m"
      memory: "16Gi"
  threads:
    datafusion: 30
  compaction:
    checkInterval: "5s"

# Processing Engine enabled for production
processingEngine:
  enabled: true
  replicas: 2

# Production ingress with TLS - overrides default values.yaml config
ingress:
  write:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/rate-limit: "1000"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: "influxdb-api.example.com"
    tls:
      - secretName: influxdb-api-tls
        hosts:
          - influxdb-api.example.com

  query:
    annotations:
      cert-manager.io/cluster-issuer: "letsencrypt-prod"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: "influxdb-api.example.com"
    tls:
      - secretName: influxdb-api-tls
        hosts:
          - influxdb-api.example.com

# Enable network policies
networkPolicy:
  enabled: true
  ingress:
    fromIngressController: true
    fromComponents: true
  egress:
    toDns: true
    toObjectStorage: true
    toKubeApi: true

# Enable monitoring
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  additionalLabels:
    prometheus: kube-prometheus

# Advanced configuration
cache:
  parquetMemCacheSize: "20%"
  lastValueCacheDisableFromHistory: false
  distinctValueCacheDisableFromHistory: false

dataLifecycle:
  retentionCheckInterval: "15m"
  deleteGracePeriod: "24h"

logging:
  filter: "info"
  queryLogSize: 10000

telemetry:
  disableUpload: false
